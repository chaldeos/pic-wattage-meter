;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;Copyright (c) 2013 Manolis Agkopian and John Haldeos	      ;
;See the file LICENCE for copying permission.		      ;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;
;ADC INIT PROC
;
ADC_INIT:
	MOVWF TMP
	BSF STATUS, 5 ;SELECT BANK 01

	;RIGHT JUSTIFIED RESULT, +VREF=VDD, -VREF=VSS, AN0-AN7=ANALOG
	MOVLW B'10000000'
	MOVWF ADCON1

	BCF STATUS, 5 ;SELECT BANK 00

	;FOSC/8, ADON=1
	MOVF TMP, W
	MOVWF ADCON0

	RETURN

;
;ADC READ PROC
;
ADC_READ:
	BCF STATUS, 5 ;SELECT BANK 00

	BSF ADCON0, 2 ;START CONVERTION PROCESS (WE SET THE GO BIT)
WAIT:
	BTFSC ADCON0, 2
	GOTO WAIT ;WAIT FOR CONVERTION TO FINISH (WAIT FOR GO BIT TO CLEAR)

	MOVF ADRESH, W
	ANDLW B'00000011' ;JUST IN CASE WE CLEAR BIT 7 TO BIT 2
	MOVWF CONVRESH
	
	BSF STATUS, RP0 ;SELECT BANK 01
	MOVF ADRESL, W
	BCF STATUS, RP0 ;SELECT BANK 00
	MOVWF CONVRESL
	
	RETURN